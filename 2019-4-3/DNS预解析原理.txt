http://www.ruanyifeng.com/blog/2016/06/dns.html
http://www.sunhao.win/articles/netwrok-dns.html
https://zhuanlan.zhihu.com/p/28305778

1.什么是DNS?
    DNS （Domain Name System 的缩写）的作用非常简单，就是根据域名查出IP地址。你可以把它想象成一本巨大的电话本。
    DNS（Domain Name System，域名系统），最初，由于ip长且难记，通过ip访问网站不方便。。
    所以后来通过发明了DNS服务器，这个时候我们访问网站输入网站域名，DNS服务器就解析我们的域名为ip。这样我们实际访问的就是对应的ip地址啦。
    抽象点DNS就是 一个记录ip地址的超级分布式数据库。

    举例来说，如果你要访问域名math.stackexchange.com，首先要通过DNS查出它的IP地址是151.101.129.69。

2.根域和根域服务器
    本机到底怎么得到域名math.stackexchange.com的IP地址 ？

    当我们输入www.sunhao.win访问网站。实际上是访问了不同的域。其中”.”是DNS 命称空间，用来分割不同域,
    www,sunhao,win分别代表不同的域。其实还有个域，跟在win后面，只是因为是域名系统默认的,所以这里不用写，这个就是根域。
    意义上域名应该是这样。www.sunhao.win.根域。

    www(三级域)和sunhao.win叫二级域名www.sunhao.win

    因为我们上网使用的UDP/TCP，UDP数据往往没有保障,但速度快,通常用于查询和响应，TCP由于多次验证，传输有保证，但速度慢，多用于主服务器和从服务器之间的传送。
    因此我们DNS主要通过UDP。
    当我们访问www.sunhao.win的时候,如果本地dns服务器没有记录，那么它就会向根服务器去请求地址。
    也就是它会向根服务器请求win域的地址。然后通过win域继续向下请求。根域名服务器并不直接把待查询的域名直接解析出IP地址，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。
    所以根域名服务器很重要。假定所有的根域名服务器都瘫痪了，那么整个DNS系统就无法工作。

3.顶级域和顶级域服务器
    例如www.sunhao.win

    win所在的位置就是顶级域

4.运营商DNS服务器和本地DNS服务器
    在实际上网中，我们不是直接连接根服务器，而是通过本地DNS服务器上网。
    如果DNS设置不好，或者不对，会导致如我们qq能登陆，而页面无法浏览网页的症状、
    在这，本地DNS主要指是指各地电信运营商提供的域名解析服务器。也就是我们在上网网卡里面你设置的DNS地址。当然也可以自己建设一个服务器。

    mark

    当一个主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器，本地服务器替我们进行DNS解析,我们得到的ip地址是由本地服务器返回的

5.查询 常规DNS系统如何运作的？
    1，用户—>本地递归服务器— > 根权威服务器— > COM权威服务器— > X(X代表任意地址).COM权威服务器— > 本地递归服务器— >用户
    2，用户—>本地递归服务器— > 缓存 — >用户

    一、递归查询:主机向本地域名服务器的查询一般都是采用递归查询。
        所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，
        向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。
        因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。

        简单说 就是说我们请求的地址 必须返回一个准确的ip地址，没有就向别的地址查询，然后返回给我们一个准确的ip地址。我们的本地服务器就是递归服务器。

    二、迭代查询:本地域名服务器向根域名服务器的查询的迭代查询。
        迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，
        要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。
        根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。
        顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。
        最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机。

        这里由各级服务器进行的就是迭代查询，自身不返回ip，而是返回给下一级的DNS服务器地址。

6.为什么需要IP地址
    TCP/IP 网络是通过 IP 地址来确定通信对象的，不知道 IP 地址就无法将消息发送给对方，
    因此，在委托操作系统发送消息时，必须要先查询好对方 的 IP 地址。

    TIP:如果 Web 服务器使用了虚拟主机功能,有可能无法通过 IP 地址来访问。
    因为虚拟主机是寄存在服务器上的一个或多个没有实体的服务器，访问虚拟主机的域名的时候，
    先根据DNS解析的IP访问到实体主机，然后实体主机再根据域名把连接转发给对应的虚拟主机，
    DNS解析的IP只是实体主机的IP（并不是要访问的web应用服务器IP地址）。

7.域名和 IP 地址并用的理由
    (1)不用IP 地址，而是用名称来确定通信对象?
        IP 地址的长度 为 32 比特（ 4 字节），使用域名最少也要几十个字节，最长可达到255字节，增加了路由器的负担,传送数据也会花费更长的时间 ，
        运行效率较低。（路由转发包传输数据）

    (2)浏览器网址中不写服务器的名字，直接写IP 地址?
        用IP地址来代替服务器名称也是能够正常工作的 。然而,要记住一串由数字组成的 IP 地址也非常困难
        让人来使用名称,让路由器来使用IP地址。
        为了填补两者之间的障碍,需要有一个机制能够通过名称来查询IP地址,或者通过IP 地址来查询名称,这个机制就是DNS

8.浏览器是如何向 DNS 服务器发出查询
    (1)浏览器搜索自身的DNS缓存：
        首先浏览器会去搜索自身的DNS缓存，看缓存有没有过期，过期的话缓存的解析就结束了
        （chrome缓存的时间只有一分钟，查看chrome的缓存可打开：chrome://net-internals/#dns ）。
    (2)搜索操作系统自身的DNS缓存：
        如果浏览器没有找到缓存或者缓存过期失效，浏览器就会搜索操作系统自身的缓存，没有找到或者失效，
        解析结束（操作系统的缓存：window系统是一天，mac系统严格根据DNS协议中的TTL）。
    (3)读取本地的hosts文件：
        若操作系统的缓存也没有找到或失效，浏览器就会去读取本地的hosts文件（Hosts文件也可以建立域名到IP地址的绑定关系，
        可以通过编辑Hosts文件来达到名称解析的目的。 例如，我们需要屏蔽某个域名时，就可以将其地址指向一个不存在IP地址，以达到屏蔽的效果）。
    (4)浏览器发起一个DNS的系统调用：
        hosts中没有找到对应的配置项的话，浏览器发起一个DNS的调用（向本地主控DNS服务，一般来说是你的运营商提供的）。